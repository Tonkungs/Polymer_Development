<!-- import -->
<!-- <link rel="import" href="my-gridster.html"> -->
<link rel="import" href="my-card.html">
<dom-module id="my-contents">
  <style>
    :host {
      display: block;
    }
    .flex-horizontal{
      @apply(--layout-horizontal);
      @apply(--layout-wrap);
       /*@apply(--layout-around-justified);*/
    }
    .flex{
      @apply(--layout-flex);
    }
    #pane_add{
      position: fixed;
      right: 0;
      bottom: 0px;
      margin-bottom: 10px;
      margin-right: 25px;
    }
  </style>
  <template>
    <div class="flex-horizontal">
     <!-- <firebase-collection
       location="https://yellow-line.firebaseio.com/panes"
       data="{{panes}}"></firebase-collection> -->
       <template is="dom-repeat" items="[[panes]]">
          <my-card data="[[item]]"></my-card>
       </template>

    </div>
    <paper-fab mini icon="add" id ="pane_add" on-tap="addPane" title="เพิ่มแผ่นงาน"></paper-fab>
  <!-- <my-gridster></my-gridster> -->
  </template>
  <script>
    Polymer({
      is: "my-contents",
      properties: {
        pane: {
          type: Object
        }
      },
      ready: function() {
        // console.log(this.panes);
        const testfn = (data) => {
          this.panes = data;
        }
        var newPostKey = firebase.database().ref().child('/panes').push().key;
        let panes = [];
        let datasRef = firebase.database().ref("/panes");
        datasRef.on('value', (snapshot)=>{
          panes = [];
          //console.log(snapshot.val());
          let getData;
          let testGetData = snapshot.val();
          for(var key in testGetData){
            getData = testGetData[key]
            let getDataSub = [];
            let subData = testGetData[key].component;
            for(var key2 in subData){
              getDataSub.push(subData[key2]);
            }
            getData.component = getDataSub;

            panes.push(testGetData[key]);
          }
          //console.log(panes);
          testfn(panes);
        });
        // console.log(this.panes);
      },
        addPane: function(){
          var newPostKey = firebase.database().ref().child('panes').push().key;
          var postData = {
            name:"ดูกราฟ",
            key:newPostKey
          };
          var updates = {};
              updates['/panes/' + newPostKey] = postData;
          return firebase.database().ref().update(updates);
        }
    });


  </script>
</dom-module>
